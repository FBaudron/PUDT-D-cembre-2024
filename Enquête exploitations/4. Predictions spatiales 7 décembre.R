#' ---
#' title: "Predictions spatiales"
#' author: "Frédéric Baudron"
#' date: "7 Décembre, 2024"
#' ---


# CLEAR ENVIRONMENT-------------------------------------------------------------

rm(list = ls())


# LOADING NECESSARY PACKAGES----------------------------------------------------

library(openxlsx)
library(terra)
library(geodata)
library(dplyr)
library(randomForest)
library(SpatialML)

# SETTING UP THE DIRECTORY & LOADING THE DATA-----------------------------------

setwd("D:\\Mes Donnees\\1. Cirad\\PUDT\\Enquête\\")


loc = read.xlsx("Input_files\\1.1. Localisation avec types esquisse.xlsx", sheet = 1)
enq = read.xlsx("Input_files\\2. Enquêté.xlsx", sheet = 1)
chf = read.xlsx("Input_files\\3.2. Chef de famille.xlsx", sheet = 1)
hst = read.xlsx("Input_files\\4. Histoire.xlsx", sheet = 1)
sec = read.xlsx("Input_files\\5. Sécurité alimentaire.xlsx", sheet = 1)
agr = read.xlsx("Input_files\\6.1. Agriculture générale.xlsx", sheet = 1)
chp = read.xlsx("Input_files\\6.2. Champs.xlsx", sheet = 1)
div = read.xlsx("Input_files\\6.3. Diversité cultures.xlsx", sheet = 1)
man = read.xlsx("Input_files\\6.4.1. Manioc.xlsx", sheet = 1)
mai = read.xlsx("Input_files\\6.4.2. Maïs.xlsx", sheet = 1)
soj = read.xlsx("Input_files\\6.4.3. Soja.xlsx", sheet = 1)
ara = read.xlsx("Input_files\\6.4.4. Arachide.xlsx", sheet = 1)
saf = read.xlsx("Input_files\\6.4.5. Safou.xlsx", sheet = 1)
cac = read.xlsx("Input_files\\6.4.6. Cacao.xlsx", sheet = 1)
caf = read.xlsx("Input_files\\6.4.7. Café.xlsx", sheet = 1)
pla = read.xlsx("Input_files\\6.4.8. Plantain.xlsx", sheet = 1)
pal = read.xlsx("Input_files\\6.4.9. Palmier.xlsx", sheet = 1)
ori = read.xlsx("Input_files\\6.5. Orientation.xlsx", sheet = 1)
pre = read.xlsx("Input_files\\6.6. Précédent et status.xlsx", sheet = 1)
bet = read.xlsx("Input_files\\6.7.1. Production bétail.xlsx", sheet = 1)
psn = read.xlsx("Input_files\\6.7.2. Production poissons.xlsx", sheet = 1)
res = read.xlsx("Input_files\\6.8. Ressources naturelles.xlsx", sheet = 1)
rev = read.xlsx("Input_files\\7.1. Revenus principaux.xlsx", sheet = 1)
rvt = read.xlsx("Input_files\\7.2. Revenus totaux.xlsx", sheet = 1)
fct = read.xlsx("Input_files\\8.1. Force de travail.xlsx", sheet = 1)
dyn = read.xlsx("Input_files\\8.2. Dynamiques de l'exploitation.xlsx", sheet = 1)
eqt = read.xlsx("Input_files\\8.3 Equipement.xlsx", sheet = 1)
acc = read.xlsx("Input_files\\9.1. Accompagnement.xlsx", sheet = 1)
ctr = read.xlsx("Input_files\\9.2. Contrats.xlsx", sheet = 1)
mch = read.xlsx("Input_files\\9.3. Distance au marché.xlsx", sheet = 1)
psp = read.xlsx("Input_files\\10. Perspectives.xlsx", sheet = 1)


# names(enq)
enq = enq[, c(1, 4, 23)]
# names(chf)
chf = chf[, c(1, 3:4)]
# names(hst)
hst = hst[, c(1:2)]
# names(sec)
sec = sec[, c(1, 3)]
# names(agr)
agr = agr[, c(1:2, 4, 6, 9:10)]
# names(chp)
chp = chp[, c(1, 52:67, 69:76, 78)]
chp$destructions_animaux = as.numeric(chp$destructions_animaux == "Oui")
chp$pertes_climat = as.numeric(chp$pertes_climat == "Oui")
chp$voleurs = as.numeric(chp$voleurs == "Oui")
chp$bovins[is.na(chp$bovins)] = 0
chp$chevres[is.na(chp$chevres)] = 0
chp$moutons[is.na(chp$moutons)] = 0
chp$elephants[is.na(chp$elephants)] = 0
chp$buffles[is.na(chp$buffles)] = 0
chp$hippopotames[is.na(chp$hippopotames)] = 0
chp$cochons_sauvages[is.na(chp$cochons_sauvages)] = 0
chp$antilopes[is.na(chp$antilopes)] = 0
chp$grands_singes[is.na(chp$grands_singes)] = 0
chp$petits_singes[is.na(chp$petits_singes)] = 0
chp$rongeurs[is.na(chp$rongeurs)] = 0
chp$oiseaux[is.na(chp$oiseaux)] = 0
chp$mille_pattes[is.na(chp$mille_pattes)] = 0
chp$criquets[is.na(chp$criquets)] = 0
chp$chenilles[is.na(chp$chenilles)] = 0
chp$secheresse[is.na(chp$secheresse)] = 0
chp$chaleur[is.na(chp$chaleur)] = 0
chp$secheresse[is.na(chp$secheresse)] = 0
chp$inondation[is.na(chp$inondation)] = 0
chp$incendie[is.na(chp$incendie)] = 0
chp$precipitation[is.na(chp$precipitation)] = 0
chp$vent[is.na(chp$vent)] = 0
chp$glissement[is.na(chp$glissement)] = 0
chp = aggregate(. ~ id, FUN = sum, na.rm = TRUE, data = chp)
chp[, c(2:26)] = ifelse(chp[, c(2:26)] > 0, 1, 0)
# names(div)
div = div[, c(1:5, 20:22, 24:25, 34:37)]
# names(man)
man = man[, c(1, 66:69)]
# names(mai)
mai = mai[, c(1, 46:49)]
# names(soj)
soj = soj[, c(1, 43:44)]
# names(ara)
ara = ara[, c(1, 42:45)]
# names(saf)
saf = saf[, c(1, 21:22)]
# names(cac)
cac = cac[, c(1, 12, 23)]
# names(caf)
caf = caf[, c(1, 11, 22)]
# names(pla)
pla = pla[, c(1, 10:13)]
# names(pal)
pal = pal[, c(1, 32:33)]
# names(ori)
ori = ori[, c(1, 15)]
# names(pre)
pre = pre[, c(1:2, 4:5)]
# names(bet)
bet = bet[, c(1:11, 23, 27:30)]
# names(psn)
psn = psn[, c(1:2)]
# names(res)
res = res[, c(1:2, 4, 6, 18:28, 31)]
# names(rev)
rev = rev[, c(1:2)]
# names(rvt)
rvt$revenu_agricole = rvt$revenu_agricole + rvt$revenu_elevage + rvt$revenu_pisciculture
rvt$revenu_res_nat = rvt$revenu_peche + rvt$revenu_chasse + rvt$revenu_cueillette + rvt$revenu_orpaillage + rvt$revenu_exploitation_forestiere
rvt$autre = rvt$revenu_boutique + rvt$revenu_ouvrier + rvt$revenu_employe + rvt$revenu_cadre + rvt$revenu_autre
rvt = rvt[, c(1:2, 17, 15)]
# names(fct)
fct = fct[, c(1:3)]
# names(dyn)
dyn = dyn[, c(1:2, 11)]
# names(eqt)
eqt$voit_kav_mot_usage = eqt$voiture_usage + eqt$kavaki_usage + eqt$moto_usage
eqt$voit_kav_mot_usage = ifelse(eqt$voit_kav_mot_usage > 0, 1, 0)
eqt = eqt[, c(1:2, 31, 30, 19, 27:28)]
# names(acc)
acc = acc[, c(1:2)]
# names(ctr)
ctr = ctr[, c(1:2)]
# names(mch)
mch = mch[, c(1:5)]
# names(psp)

data = merge(loc, enq, by = "id", all.x = TRUE)
data = merge(data, chf, by = "id", all.x = TRUE)
data = merge(data, hst, by = "id", all.x = TRUE)
data = merge(data, sec, by = "id", all.x = TRUE)
data = merge(data, agr, by = "id", all.x = TRUE)
data = merge(data, chp, by = "id", all.x = TRUE)
data = merge(data, div, by = "id", all.x = TRUE)
data = merge(data, man, by = "id", all.x = TRUE)
data = merge(data, mai, by = "id", all.x = TRUE)
data = merge(data, soj, by = "id", all.x = TRUE)
data = merge(data, ara, by = "id", all.x = TRUE)
data = merge(data, saf, by = "id", all.x = TRUE)
data = merge(data, cac, by = "id", all.x = TRUE)
data = merge(data, caf, by = "id", all.x = TRUE)
data = merge(data, pla, by = "id", all.x = TRUE)
data = merge(data, pal, by = "id", all.x = TRUE)
data = merge(data, ori, by = "id", all.x = TRUE)
data = merge(data, pre, by = "id", all.x = TRUE)
data = merge(data, bet, by = "id", all.x = TRUE)
data = merge(data, psn, by = "id", all.x = TRUE)
data = merge(data, res, by = "id", all.x = TRUE)
data = merge(data, rev, by = "id", all.x = TRUE)
data = merge(data, rvt, by = "id", all.x = TRUE)
data = merge(data, fct, by = "id", all.x = TRUE)
data = merge(data, dyn, by = "id", all.x = TRUE)
data = merge(data, eqt, by = "id", all.x = TRUE)
data = merge(data, acc, by = "id", all.x = TRUE)
data = merge(data, ctr, by = "id", all.x = TRUE)
data = merge(data, mch, by = "id", all.x = TRUE)
data = merge(data, psp, by = "id", all.x = TRUE)


data$education_chef_fam = ifelse(data$education_chef_fam == "Aucun", 0,
                                 ifelse(data$education_chef_fam == "Education primaire", 0, 1))

data$jachere = ifelse(data$jachere > 0, 1, 0)

data$surface_louee = ifelse(data$surface_louee > 0, 1, 0)

data$manioc_production = ifelse(data$manioc_production > 0, 1, 0)

names(data)

data$bovins.y = ifelse(data$bovins.y > 0, 1, 0)
data$porcs = ifelse(data$porcs > 0, 1, 0)
data$petits_ruminants = ifelse(data$petits_ruminants > 0, 1, 0)
data$volailles = ifelse(data$volailles > 0, 1, 0)
data$ubt = ifelse(data$ubt > 0, 1, 0)

data$oeuf_productivite[is.na(data$oeuf_productivite)] = 0
data$oeuf_productivite = ifelse(data$oeuf_productivite > 0, 1, 0)

data$alim_appoint_bovins[is.na(data$alim_appoint_bovins)] = 0
data$alim_appoint_petits_ruminants[is.na(data$alim_appoint_petits_ruminants)] = 0
data$alim_appoint_porcs[is.na(data$alim_appoint_porcs)] = 0
data$alim_appoint_volailles[is.na(data$alim_appoint_volailles)] = 0

data$alim = data$alim_appoint_bovins + data$alim_appoint_petits_ruminants +
  data$alim_appoint_porcs + data$alim_appoint_volailles

data$alim = ifelse(data$alim > 0, 1, 0)

data$nb_etangs = ifelse(data$nb_etangs > 0, 1, 0)

data$nb_pfnl = data$chasse + data$peche + data$charbon + data$miel + data$fruits +
  data$feuilles + data$asperges + data$rotins + data$ecorces + data$poivre + data$seve +
  data$seve + data$noix + data$chenilles.y + data$champignons

data$source_rev_1 = as.numeric(data$source_rev_1 == "Agriculture")

data$evolution_surf_cult_passe = as.numeric(data$evolution_surf_cult_passe == "Augmenté")

data$eqp_value = ifelse(data$eqp_value > 0, 1, 0)

data$ou_vendez_vous_vos_produits_village[is.na(data$ou_vendez_vous_vos_produits_village)] = 0
data$ou_vendez_vous_vos_produits_goudron[is.na(data$ou_vendez_vous_vos_produits_goudron)] = 0
data$ou_vendez_vous_vos_produits_chef_lieu_district_ou_departement[is.na(data$ou_vendez_vous_vos_produits_chef_lieu_district_ou_departement)] = 0
data$ou_vendez_vous_vos_produits_brazzaville_pointe_noire[is.na(data$ou_vendez_vous_vos_produits_brazzaville_pointe_noire)] = 0

data$reprise = as.numeric(data$reprise == "Oui")

data$statut_champ = ifelse(data$statut_champ == "Propriété", 1, 0)


# LOAD RASTERS------------------------------------------------------------------

# Country shapefile

cog0 = gadm(country = 'COG', level = 0, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
cog1 = gadm(country = 'COG', level = 1, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
cog2 = gadm(country = 'COG', level = 2, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')

# plot(cog0)
# plot(cog1)
# plot(cog2)

# Esquisse des paysages agricoles

esq = vect("D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\esquisse\\congo paysages ok 2 tx defrich.shp")
plot(cog0, col='lightgrey', main = 'Esquisses agricoles', panel.first = grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(esq, col = c("#6BAED6","#BDD7E7","#74C476","#BAE4B3","#238B45",
                  "#08519C", "#3182BD","#A63603", "#E6550D",
                  "#FD8D3C", "#FDBE85"),
     legend = TRUE, axes = F, add = T)
plot(cog1, axes=F, add=T)
points(15.2813, -4.2744, pch = 21, bg = 'orangered', cex=2)
points(11.8664, -4.7692, pch = 21, bg = 'orangered', cex=2)


# Elevation

# elevation = geodata::elevation_30s("COG", path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\elevation')

elevation1 = geodata::elevation_3s(lon = (11 + 18.8)/2, lat = (-5.2 + 3.9)/2, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\elevation')
elevation1 = terra::crop(elevation1, esq)
elevation1 = terra::mask(elevation1, esq)
names(elevation1) = 'elevation'
elevation2 = geodata::elevation_3s(lon = ((11 + 18.8)/2)+2, lat = (-5.2 + 3.9)/2, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\elevation')
elevation2 = terra::crop(elevation2, esq)
elevation2 = terra::mask(elevation2, esq)
names(elevation2) = 'elevation'
elevation3 = geodata::elevation_3s(lon = (11 + 18.8)/2, lat = ((-5.2 + 3.9)/2)+2, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\elevation')
elevation3 = terra::crop(elevation3, esq)
elevation3 = terra::mask(elevation3, esq)
names(elevation3) = 'elevation'
elevation4 = geodata::elevation_3s(lon = ((11 + 18.8)/2)+2, lat = ((-5.2 + 3.9)/2)+2, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\elevation')
elevation4 = terra::crop(elevation4, esq)
elevation4 = terra::mask(elevation4, esq)
names(elevation4) = 'elevation'

s = sprc(elevation1, elevation2, elevation3, elevation4)
elevation = merge(s)

plot(elevation)

elevation


# 1 degree latitude at the equator = 111320 m
# 0.0008333333 * 111320 = 92.76666

# png("Elevation.png", units="in", width=7, height=7.5, res=1000)
par(mfrow=c(1,1), mar=c(0.1,0.1,0.1,1), cex.main=1.95, cex.axis=1.6)
plot(cog0, col='lightgrey', main='Elevation (m a.s.l.)', panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(elevation, 
     legend=TRUE, axes=F, add=T)
plot(cog1, axes=F, add=T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# dev.off()


# Total rainfall

rain = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\chirps-rainfall\\longterm-mean-yearly-rainfall.tif')
rain = terra::crop(rain, esq)
rain = terra::mask(rain, esq)
rain = terra::resample(rain, elevation)
names(rain) = 'rain'
# png("Total rainfall.png", units="in", width=7, height=7.5, res=1000)
par(mfrow=c(1,1), mar=c(0.1,0.1,0.1,1), cex.main=1.95, cex.axis=1.6)
plot(cog0, col='lightgrey', main='Total rainfall (mm/year)', panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(rain,
     legend=TRUE, axes=F, add=T)
plot(cog1, axes=F, add=T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# dev.off()


# Distance à la route

route = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\road\\Distance_route_OSM.tif')
route = terra::crop(route, esq)
route = terra::mask(route, esq)
route = terra::resample(route, elevation)
names(route) = 'route'
# png("Distance to market.png", units="in", width=7, height=7.5, res=1000)
pal = colorRampPalette(c('wheat', 'orange', 'orangered', 'red'))
par(mfrow=c(1,1), mar=c(0.1,0.1,0.1,1), cex.main=1.95, cex.axis=1.6)
plot(cog0, col='lightgrey', main='Distance à la route (km)', panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(route, 
     col=pal(50), 
     legend=TRUE, axes=F, add=T)
plot(cog1, axes=F, add=T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# dev.off()


# Soc 

soc_5 = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\isda-soil\\soil_af\\af_soc_0-5cm_30s.tif')
soc_15 = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\isda-soil\\soil_af\\af_soc_5-15cm_30s.tif')
soc_30 = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\isda-soil\\soil_af\\af_soc_15-30cm_30s.tif')
soc = (soc_5 * 5 + soc_15 * 10 + soc_30 * 15) / (5 + 10 + 15)
soc = terra::crop(soc, esq)
soc = terra::mask(soc, esq)
soc = terra::resample(soc, elevation)
names(soc) = 'soc'
# png("Soil organic carbon.png", units="in", width=7, height=7.5, res=1000)
pal = colorRampPalette(c('wheat', 'orange', 'orangered', 'red'))
par(mfrow=c(1,1), mar=c(0.1,0.1,0.1,1), cex.main=1.95, cex.axis=1.6)
plot(cog0, col='lightgrey', main='Soil organic carbon (g/kg 0-30 cm depth)', panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(soc, 
     col=pal(50), legend=TRUE, axes=F, add=T)
plot(cog1, axes=F, add=T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# dev.off()


# texture

sand_5 = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\isda-soil\\soil_af\\af_sand_0-5cm_30s.tif')
sand_15 = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\isda-soil\\soil_af\\af_sand_5-15cm_30s.tif')
sand_30 = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\isda-soil\\soil_af\\af_acid-exch_15-30cm_30s.tif')
sand = (sand_5 * 5 + sand_15 * 10 + sand_30 * 15) / (5 + 10 + 15)
sand = terra::crop(sand, esq)
sand = terra::mask(sand, esq)
sand = terra::resample(sand, elevation)
names(sand) = 'sand'
# png("Sand.png", units="in", width=7, height=7.5, res=1000)
pal = colorRampPalette(c('wheat', 'orange', 'orangered', 'red'))
par(mfrow=c(1,1), mar=c(0.1,0.1,0.1,1), cex.main=1.95, cex.axis=1.6)
plot(cog0, col='lightgrey', main='Sand (%, 0-30 cm depth)', panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(sand, 
     col=pal(50), legend=TRUE, axes=F, add=T)
plot(cog1, axes=F, add=T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# dev.off()

# Population density

pop_dens = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\population\\COG10adjv3.tif')
pop_dens = terra::crop(pop_dens, esq)
pop_dens = terra::mask(pop_dens, esq)
# pop_dens = pop_dens/100  # convert to person/km2
# pop_dens = terra::aggregate(pop_dens, 10)
pop_dens = terra::resample(pop_dens, elevation)
names(pop_dens) = 'pop_dens'
# png(file=paste0(output_path, "./3-population-density.png"), 
#      height = 7, width = 9, units="in", res=1000)
pal = colorRampPalette(c('wheat', 'orange', 'orangered'))
par(mfrow=c(1,1), mar=c(0.1,0.1,0.1,1), las=1)
plot(cog0, col='lightgrey', main='Densité de population (person/km2)', panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(pop_dens,  
     breaks=c(0, 0.005, 0.01, 0.02, 0.05, 0.1, 0.5, 1, Inf), col = pal(8), 
     axes=F, add=T)
plot(cog1, add=TRUE)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# dev.off()


lon = init(elevation, 'x')
lon = terra::crop(lon, esq)
lon = terra::mask(lon, esq)
lon = terra::resample(lon, elevation)
names(lon) = "longitude"

lat = init(elevation, 'y')
lat = terra::crop(lat, esq)
lat = terra::mask(lat, esq)
lat = terra::resample(lat, elevation)
names(lat) = "latitude"

plot(lon)
plot(lat)


# df to spatial ----------------------------------------------------------------

data_spatial = data %>%
  sf::st_as_sf(coords = c("longitude", "latitude")) %>%
  sf::st_set_crs(4326)

# merge dataset ----------------------------------------------------------------

esq_raster = rasterize(esq, elevation, field = "type", background = NA)

esq_raster

mosaique = esq_raster == 0 | esq_raster == 1 | esq_raster == 5 | esq_raster == 6
mosaique = subst(mosaique, c(FALSE, TRUE), c(NA, 2))
plot(mosaique)

foret = esq_raster == 2 | esq_raster == 3 | esq_raster == 4
foret = subst(foret, c(FALSE, TRUE), c(NA, 3))
plot(foret)

savane = esq_raster == 7 | esq_raster == 8 | esq_raster == 9 | esq_raster == 10
savane = subst(savane, c(FALSE, TRUE), c(NA, 1))
plot(savane)

# esq_raster_3classes = mosaique + foret + savane

s <- sprc(mosaique, foret, savane)
esq_raster_3classes <- merge(s)

plot(esq_raster_3classes)

esq_raster_3classes = as.factor(esq_raster_3classes)



is.factor(esq_raster_3classes)

esq_raster_3classes


is.factor(esq_raster)




stacked = c(esq_raster, elevation, rain, route, soc, sand, lon, lat, pop_dens)

plot(stacked)

names(data)[8:10] = c("esquisse1", "esquisse2", "esquisse3")

names(data)

data = cbind(data, terra::extract(stacked, terra::vect(data_spatial)))

names(data)

data$type



# Revenu agricole

data_rev_ag = na.omit(data[, c("revenu_agricole", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])

par(mar=c(3,3,3,3))

# boxplot(data_rev_ag$revenu_agricole)
# data_rev_ag =  data_rev_ag[data_rev_ag$revenu_agricole < 3500000,]
# boxplot(data_rev_ag$revenu_agricole)

hist(data_rev_ag$revenu_agricole)

# quantile(data_rev_ag$revenu_agricole, c(.33, .67))

median(data_rev_ag$revenu_agricole)

# data_rev_ag$revenu_agricole <- cut(data_rev_ag$revenu_agricole,
#                                    breaks = c(-Inf, 100000, 400000, Inf),
#                                    labels = c("0 to 100000", "100000 to 400000", "> 400000"))

data_rev_ag$revenu_agricole <- cut(data_rev_ag$revenu_agricole,
                                   breaks = c(-Inf, 250000, Inf),
                                   labels = c("0 to 250000", "> 250000"))



data_rev_ag$revenu_agricole = as.factor(data_rev_ag$revenu_agricole)

data_rev_ag$type = as.factor(data_rev_ag$type)

rf_rev_ag = randomForest(revenu_agricole ~ elevation + rain + route + soc + sand 
                         + longitude + latitude
                         + pop_dens + type,
                         data = data_rev_ag, ntree = 1500)


rf_rev_ag

rf_rev_ag$confusion
rf_rev_ag$importance
# pdp plots
# partialPlot(rf_rev_ag, data, geosurvey_ha, "1")
# spatial prediction

# f <- list(esquisse = levels(esq_raster_3classes$esquisse))
# map <- predict(rf_rev_ag, data = stacked, factors = f)
# plot(map)

rf_rev_ag_pred = predict(stacked, rf_rev_ag, na.rm = T)

# rf_rev_ag_pred = predict(object = stacked, model = rf_rev_ag, type = "response", na.rm = T, factors = f)

plot(rf_rev_ag_pred)

rf_rev_ag_pred

png("Prédiction du revenu agricole.png", units="in", width = 7.5, height = 7, res = 1000)
plot(cog0, col='lightgrey', main = "Prédiction du revenu agricole", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(rf_rev_ag_pred, legend = T, axes = F, add = T,
     # breaks = c(0, 350000, 500000, Inf)
     ) 
plot(cog1, axes = F, add = T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
dev.off()

stacked = c(stacked, rf_rev_ag_pred)

################################################################################

# names(data)
# 
# data_rev_ag = na.omit(data[, c("revenu_agricole", "latitude", "longitude", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# par(mar=c(3,3,3,3))
# 
# boxplot(data_rev_ag$revenu_agricole)
# data_rev_ag =  data_rev_ag[data_rev_ag$revenu_agricole < 3500000,]
# boxplot(data_rev_ag$revenu_agricole)
# 
# data_rev_ag$revenu_agricole = as.numeric(data_rev_ag$revenu_agricole)
# 
# data_rev_ag$type = as.factor(data_rev_ag$type)
# 
# 
# Coords  = data_rev_ag[, 2:3]
# 
# bwe <- grf.bw(revenu_agricole ~ elevation + rain + route + soc + sand + longitude + latitude + pop_dens + type,
#              dataset = data_rev_ag, kernel ="adaptive",
#              coords = Coords, bw.min = 50, bw.max = 60, step = 2,
#              forests = FALSE, weighted = TRUE)
# 
# bwe$Best.BW
# 
# grf <- grf(revenu_agricole ~ elevation + rain + route + soc + sand + longitude + latitude + pop_dens + type,
#            dframe = data_rev_ag, bw = bwe$Best.BW,
#            kernel = "adaptive", coords = Coords)
# 
# stacked_df = as.data.frame(stacked, xy = TRUE)
# 
# rf_rev_ag_pred = predict.grf(grf, stacked, x.var.name = "x", y.var.name = "y", local.w=1, global.w=0)
# 
# plot(rf_rev_ag_pred)

################################################################################


# Expansion des cultures

# data_evol = na.omit(data[, c("evolution_surf_cult_passe", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_evol$evolution_surf_cult_passe = as.factor(data_evol$evolution_surf_cult_passe)
# 
# rf_evol = randomForest(evolution_surf_cult_passe ~ 
#                          type + 
#                          elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                          data = data_evol, ntree = 1500)
# rf_evol$confusion
# rf_evol$importance
# # pdp plots
# # partialPlot(rf_evol, data, geosurvey_ha, "1")
# # spatial prediction
# rf_evol_pred = predict(stacked, rf_evol, type = 'prob', na.rm = T)
# names(rf_evol_pred) = c('evol_absence', 'evol_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'expansion dans les 5 dernières années", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_evol_pred$evol_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_evol_pred)


# Manioc

data_manioc = na.omit(data[, c("manioc", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])

data_manioc$manioc = as.factor(data_manioc$manioc)

rf_manioc = randomForest(manioc ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
                         data = data_manioc, ntree = 1500)
rf_manioc$confusion
rf_manioc$importance
# pdp plots
# partialPlot(rf_manioc, data, geosurvey_ha, "1")
# spatial prediction
rf_manioc_pred = predict(stacked, rf_manioc, type = 'prob', na.rm = T)
names(rf_manioc_pred) = c('manioc_absence', 'manioc_presence')

png("Probabilité d'occurence du manioc.png", units="in", width = 7.5, height = 7, res = 1000)
plot(cog0, col='lightgrey', main = "Probabilité d'occurence du manioc", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(rf_manioc_pred$manioc_presence, legend = T, axes = F, add = T) 
plot(cog1, axes = F, add = T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
dev.off()

stacked = c(stacked, rf_manioc_pred)


# Maïs

# data_mais = na.omit(data[, c("mais", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_mais$mais = as.factor(data_mais$mais)
# 
# rf_mais = randomForest(mais ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                          data = data_mais, ntree = 1500)
# rf_mais$confusion
# rf_mais$importance
# # pdp plots
# # partialPlot(rf_mais, data, geosurvey_ha, "1")
# # spatial prediction
# rf_mais_pred = predict(stacked, rf_mais, type = 'prob', na.rm = T)
# 
# names(rf_mais_pred) = c('mais_absence', 'mais_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence du maïs", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(1 - rf_mais_pred$mais_absence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_mais_pred)


# Arachide

data_arachide = na.omit(data[, c("arachide", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])

data_arachide$arachide = as.factor(data_arachide$arachide)

rf_arachide = randomForest(arachide ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
                           data = data_arachide, ntree = 1500)

rf_arachide$confusion
rf_arachide$importance
# pdp plots
# partialPlot(rf_arachide, data, geosurvey_ha, "1")
# spatial prediction
rf_arachide_pred = predict(stacked, rf_arachide, type = 'prob', na.rm = T)
names(rf_arachide_pred) = c('arachide_absence', 'arachide_presence')

png("Probabilité d'occurence de l'arachide.png", units="in", width = 7.5, height = 7, res = 1000)
plot(cog0, col='lightgrey', main = "Probabilité d'occurence de l'arachide", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(rf_arachide_pred$arachide_presence, legend = T, axes = F, add = T) 
plot(cog1, axes = F, add = T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
dev.off()

stacked = c(stacked, rf_arachide_pred)


# Safoutier

data_safoutier = na.omit(data[, c("safoutier", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])

data_safoutier$safoutier = as.factor(data_safoutier$safoutier)

rf_safoutier = randomForest(safoutier ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
                            data = data_safoutier, ntree = 1500)
rf_safoutier$confusion
rf_safoutier$importance
# pdp plots
# partialPlot(rf_safoutier, data, geosurvey_ha, "1")
# spatial prediction
rf_safoutier_pred = predict(stacked, rf_safoutier, type = 'prob', na.rm = T)
names(rf_safoutier_pred) = c('safoutier_absence', 'safoutier_presence')

png("Probabilité d'occurence du safou.png", units="in", width = 7.5, height = 7, res = 1000)
plot(cog0, col='lightgrey', main = "Probabilité d'occurence du safou", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(rf_safoutier_pred$safoutier_presence, legend = T, axes = F, add = T) 
plot(cog1, axes = F, add = T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
dev.off()

stacked = c(stacked, rf_safoutier_pred)


# Cacao

# data_cacao = na.omit(data[, c("cacao", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_cacao$cacao = as.factor(data_cacao$cacao)
# 
# rf_cacao = randomForest(cacao ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                         data = data_cacao, ntree = 1500)
# rf_cacao$confusion
# rf_cacao$importance
# # pdp plots
# # partialPlot(rf_cacao, data, geosurvey_ha, "1")
# # spatial prediction
# rf_cacao_pred = predict(stacked, rf_cacao, type = 'prob', na.rm = T)
# names(rf_cacao_pred) = c('cacao_absence', 'cacao_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence du cacao", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_cacao_pred$cacao_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_cacao_pred)


# Café

# data_cafe = na.omit(data[, c("cafe", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_cafe$cafe = as.factor(data_cafe$cafe)
# 
# rf_cafe = randomForest(cafe ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                        data = data_cafe, ntree = 1500)
# rf_cafe
# rf_cafe$confusion
# rf_cafe$importance
# # pdp plots
# # partialPlot(rf_cafe, data, geosurvey_ha, "1")
# # spatial prediction
# rf_cafe_pred = predict(stacked, rf_cafe, type = 'prob', na.rm = T)
# names(rf_cafe_pred) = c('cafe_absence', 'cafe_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence du café", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_cafe_pred$cafe_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_cafe_pred)


# Plantain

data_plantain = na.omit(data[, c("plantain", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])

data_plantain$plantain = as.factor(data_plantain$plantain)

rf_plantain = randomForest(plantain ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
                           data = data_plantain, ntree = 1500)
rf_plantain
rf_plantain$confusion
rf_plantain$importance
# pdp plots
# partialPlot(rf_plantain, data, geosurvey_ha, "1")
# spatial prediction
rf_plantain_pred = predict(stacked, rf_plantain, type = 'prob', na.rm = T)
names(rf_plantain_pred) = c('plantain_absence', 'plantain_presence')

png("Probabilité d'occurence du plantain.png", units="in", width = 7.5, height = 7, res = 1000)
plot(cog0, col='lightgrey', main = "Probabilité d'occurence du plantain", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(rf_plantain_pred$plantain_absence, legend = T, axes = F, add = T) 
plot(cog1, axes = F, add = T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
dev.off()

stacked = c(stacked, rf_plantain_pred)


# Palmier

# data_palmier = na.omit(data[, c("palmier", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_palmier$palmier = as.factor(data_palmier$palmier)
# 
# rf_palmier = randomForest(palmier ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                           data = data_palmier, ntree = 1500)
# rf_palmier
# rf_palmier$confusion
# rf_palmier$importance
# # pdp plots
# # partialPlot(rf_palmier, data, geosurvey_ha, "1")
# # spatial prediction
# rf_palmier_pred = predict(stacked, rf_palmier, type = 'prob', na.rm = T)
# names(rf_palmier_pred) = c('palmier_absence', 'palmier_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence du palmier", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_palmier_pred$palmier_absence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_palmier_pred)


# Cattle

# data_bovins = na.omit(data[, c("bovins.y", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_bovins$bovins.y = as.factor(data_bovins$bovins)
# 
# rf_bovins = randomForest(bovins.y ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                          data = data_bovins, ntree = 1500)
# rf_bovins
# rf_bovins$confusion
# rf_bovins$importance
# # pdp plots
# # partialPlot(rf_cattle, data, geosurvey_ha, "1")
# # spatial prediction
# rf_bovins_pred = predict(stacked, rf_bovins, type = 'prob', na.rm = T)
# names(rf_bovins_pred) = c('bovins_absence', 'bovins_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence des bovins", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_bovins_pred$bovins_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_bovins_pred)


# Small ruminants

# data_petits_ruminants = na.omit(data[, c("petits_ruminants", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_petits_ruminants$petits_ruminants = as.factor(data_petits_ruminants$petits_ruminants)
# 
# rf_petits_ruminants = randomForest(petits_ruminants ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                                    data = data_petits_ruminants, ntree = 1500)
# rf_petits_ruminants
# rf_petits_ruminants$confusion
# rf_petits_ruminants$importance
# # pdp plots
# # partialPlot(rf_smallrum, data, geosurvey_ha, "1")
# # spatial prediction
# rf_petits_ruminants_pred = predict(stacked, rf_petits_ruminants, type = 'prob', na.rm = T)
# names(rf_petits_ruminants_pred) = c('petits_ruminants_absence', 'petits_ruminants_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence des petits ruminants", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_petits_ruminants_pred$petits_ruminants_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_petits_ruminants_pred)


# Poultry

# data_volailles = na.omit(data[, c("volailles", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_volailles$volailles = as.factor(data_volailles$volailles)
# 
# rf_volailles = randomForest(volailles ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                                  data = data_volailles, ntree = 1500)
# rf_volailles
# rf_volailles$confusion
# rf_volailles$importance
# # pdp plots
# # partialPlot(rf_poultry, data, geosurvey_ha, "1")
# # spatial prediction
# rf_volailles_pred = predict(stacked, rf_volailles, type = 'prob', na.rm = T)
# names(rf_volailles_pred) = c('volailles_absence', 'volailles_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence des volailles", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_volailles_pred$volailles_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_volailles_pred)


# Charbon

# data_charbon = na.omit(data[, c("charbon", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_charbon$charbon = as.factor(data_charbon$charbon)
# 
# rf_charbon = randomForest(charbon ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                           data = data_charbon, ntree = 1500)
# rf_charbon
# rf_charbon$confusion
# rf_charbon$importance
# # pdp plots
# # partialPlot(rf_charbon, data, geosurvey_ha, "1")
# # spatial prediction
# rf_charbon_pred = predict(stacked, rf_charbon, type = 'prob', na.rm = T)
# names(rf_charbon_pred) = c('charbon_absence', 'charbon_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence du charbon", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_charbon_pred$charbon_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_charbon_pred)


# Chasse

# data_chasse = na.omit(data[, c("chasse", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_chasse$chasse = as.factor(data_chasse$chasse)
# 
# rf_chasse = randomForest(chasse ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                          data = data_chasse, ntree = 1500)
# rf_chasse
# rf_chasse$confusion
# rf_chasse$importance
# # pdp plots
# # partialPlot(rf_chasse, data, geosurvey_ha, "1")
# # spatial prediction
# rf_chasse_pred = predict(stacked, rf_chasse, type = 'prob', na.rm = T)
# names(rf_chasse_pred) = c('chasse_absence', 'chasse_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence de la chasse", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_chasse_pred$chasse_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_chasse_pred)


# Pêche

data_peche = na.omit(data[, c("peche", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])

data_peche$peche = as.factor(data_peche$peche)

rf_peche = randomForest(peche ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
                         data = data_peche, ntree = 1500)
rf_peche
rf_peche$confusion
rf_peche$importance
# pdp plots
# partialPlot(rf_peche, data, geosurvey_ha, "1")
# spatial prediction
rf_peche_pred = predict(stacked, rf_peche, type = 'prob', na.rm = T)
names(rf_peche_pred) = c('peche_absence', 'peche_presence')

png("Probabilité d'occurence de la pêche.png", units="in", width = 7.5, height = 7, res = 1000)
plot(cog0, col='lightgrey', main = "Probabilité d'occurence de la pêche", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(rf_peche_pred$peche_presence, legend = T, axes = F, add = T) 
plot(cog1, axes = F, add = T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
dev.off()

stacked = c(stacked, rf_peche_pred)


# Miel

# data_miel = na.omit(data[, c("miel", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_miel$miel = as.factor(data_miel$miel)
# 
# rf_miel = randomForest(miel ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                        data = data_miel, ntree = 1500)
# rf_miel
# rf_miel$confusion
# rf_miel$importance
# # pdp plots
# # partialPlot(rf_miel, data, geosurvey_ha, "1")
# # spatial prediction
# rf_miel_pred = predict(stacked, rf_miel, type = 'prob', na.rm = T)
# names(rf_miel_pred) = c('miel_absence', 'miel_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence de la collecte de miel", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_miel_pred$miel_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_miel_pred)


# Chef de ménage femme

# data_foyer_femme = na.omit(data[, c("foyer_femme", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_foyer_femme$foyer_femme = as.factor(data_foyer_femme$foyer_femme)
# 
# rf_femme = randomForest(foyer_femme ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                         data = data_foyer_femme, ntree = 1500)
# rf_femme
# rf_femme$confusion
# rf_femme$importance
# # pdp plots
# # partialPlot(rf_femme, data, geosurvey_ha, "1")
# # spatial prediction
# rf_femme_pred = predict(stacked, rf_femme, type = 'prob', na.rm = T)
# names(rf_femme_pred) = c('femme_absence', 'femme_presence')
# 
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence de chefs de ménages femmes", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_femme_pred$femme_presence, legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_femme_pred)


# Destruction par les éléphants

data_elephant = na.omit(data[, c("elephants", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])

data_elephant$elephants = as.factor(data_elephant$elephants)

rf_elephant = randomForest(elephants ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
                        data = data_elephant, ntree = 1500)
rf_elephant
rf_elephant$confusion
rf_elephant$importance
# pdp plots
# partialPlot(data_elephant, data, geosurvey_ha, "1")
# spatial prediction
rf_elephant_pred = predict(stacked, rf_elephant, type = 'prob', na.rm = T)
names(rf_elephant_pred) = c('elephant_absence', 'elephant_presence')
pal = colorRampPalette(c('wheat', 'orange', 'orangered', 'red'))
png("Probabilité d'occurence de dégâts par les éléphants.png", units="in", width = 7.5, height = 7, res = 1000)
plot(cog0, col='lightgrey', main = "Probabilité d'occurence de dégâts par les éléphants", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(rf_elephant_pred$elephant_presence, col = pal(50), legend = T, axes = F, add = T) 
plot(cog1, axes = F, add = T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
dev.off()
stacked = c(stacked, rf_elephant_pred)

# Destruction par les grands singes

# data_grands_singes = na.omit(data[, c("grands_singes", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])
# 
# data_grands_singes$grands_singes = as.factor(data_grands_singes$grands_singes)
# 
# rf_grands_singes = randomForest(grands_singes ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
#                            data = data_grands_singes, ntree = 1500)
# rf_grands_singes
# rf_grands_singes$confusion
# rf_grands_singes$importance
# # pdp plots
# # partialPlot(data_elephant, data, geosurvey_ha, "1")
# # spatial prediction
# rf_grands_singes_pred = predict(stacked, rf_grands_singes, type = 'prob', na.rm = T)
# names(rf_grands_singes_pred) = c('grands_singes_absence', 'grands_singes_presence')
# pal = colorRampPalette(c('wheat', 'orange', 'orangered', 'red'))
# plot(cog0, col='lightgrey', main = "Probabilité d'occurence de dégâts par les grand singes", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
# plot(rf_grands_singes_pred$grands_singes_presence, col = pal(50), legend = T, axes = F, add = T) 
# plot(cog1, axes = F, add = T)
# points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
# points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
# 
# stacked = c(stacked, rf_grands_singes_pred)


# Vols

data_voleurs = na.omit(data[, c("voleurs", "type", "elevation", "rain", "route", "soc", "sand", "longitude", "latitude", "pop_dens")])

data_voleurs$voleurs = as.factor(data_voleurs$voleurs)

rf_voleurs = randomForest(voleurs ~ type + elevation + rain + route + soc + sand + longitude + latitude + pop_dens,
                                data = data_voleurs, ntree = 1500)
rf_voleurs
rf_voleurs$confusion
rf_voleurs$importance
# pdp plots
# partialPlot(data_elephant, data, geosurvey_ha, "1")
# spatial prediction
rf_voleurs_pred = predict(stacked, rf_voleurs, type = 'prob', na.rm = T)
names(rf_voleurs_pred) = c('voleurs_absence', 'voleurs_presence')
pal = colorRampPalette(c('wheat', 'orange', 'orangered', 'red'))
png("Probabilité d'occurence de vols de cultures.png", units="in", width = 7.5, height = 7, res = 1000)
plot(cog0, col='lightgrey', main = "Probabilité d'occurence de vols de cultures", panel.first=grid(col="gray", lty="solid"), pax=list(sides=1:2, cex.axis=1.5))
plot(rf_voleurs_pred$voleurs_presence, col = pal(50), legend = T, axes = F, add = T) 
plot(cog1, axes = F, add = T)
points(15.2813, -4.2744, pch=21, bg='orangered', cex=2)
points(11.8664, -4.7692, pch=21, bg='orangered', cex=2)
dev.off()

stacked = c(stacked, rf_elephant_pred)


