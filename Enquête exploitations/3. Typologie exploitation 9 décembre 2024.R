#' ---
#' title: "Typologie d'exploitations"
#' author: "Frédéric Baudron"
#' date: "6 décembre 2024"
#' ---


# CLEAR ENVIRONMENT-------------------------------------------------------------

rm(list = ls())


# LOADING NECESSARY PACKAGES----------------------------------------------------

library(openxlsx)
library(janitor)
library(FactoMineR)
library(factoextra)
library(vegan)
library(ade4)
library(dendextend)
library(gtsummary)
library(randomForest)
library(dplyr)
library(sf)
library(terra)
library(geodata)
library(ggpubr)


# SETTING UP THE DIRECTORY & LOADING THE DATA-----------------------------------

setwd("D:\\Mes Donnees\\1. Cirad\\PUDT\\Enquête\\")


loc = read.xlsx("Input_files\\1.1. Localisation avec types esquisse.xlsx", sheet = 1)
enq = read.xlsx("Input_files\\2. Enquêté.xlsx", sheet = 1)
chf = read.xlsx("Input_files\\3.2. Chef de famille.xlsx", sheet = 1)
hst = read.xlsx("Input_files\\4. Histoire.xlsx", sheet = 1)
sec = read.xlsx("Input_files\\5. Sécurité alimentaire.xlsx", sheet = 1)
agr = read.xlsx("Input_files\\6.1. Agriculture générale.xlsx", sheet = 1)
div = read.xlsx("Input_files\\6.3. Diversité cultures.xlsx", sheet = 1)
man = read.xlsx("Input_files\\6.4.1. Manioc.xlsx", sheet = 1)
mai = read.xlsx("Input_files\\6.4.2. Maïs.xlsx", sheet = 1)
soj = read.xlsx("Input_files\\6.4.3. Soja.xlsx", sheet = 1)
ara = read.xlsx("Input_files\\6.4.4. Arachide.xlsx", sheet = 1)
saf = read.xlsx("Input_files\\6.4.5. Safou.xlsx", sheet = 1)
cac = read.xlsx("Input_files\\6.4.6. Cacao.xlsx", sheet = 1)
caf = read.xlsx("Input_files\\6.4.7. Café.xlsx", sheet = 1)
pla = read.xlsx("Input_files\\6.4.8. Plantain.xlsx", sheet = 1)
pal = read.xlsx("Input_files\\6.4.9. Palmier.xlsx", sheet = 1)
ori = read.xlsx("Input_files\\6.5. Orientation.xlsx", sheet = 1)
pre = read.xlsx("Input_files\\6.6. Précédent et status.xlsx", sheet = 1)
bet = read.xlsx("Input_files\\6.7.1. Production bétail.xlsx", sheet = 1)
psn = read.xlsx("Input_files\\6.7.2. Production poissons.xlsx", sheet = 1)
res = read.xlsx("Input_files\\6.8. Ressources naturelles.xlsx", sheet = 1)
rev = read.xlsx("Input_files\\7.1. Revenus principaux.xlsx", sheet = 1)
rvt = read.xlsx("Input_files\\7.2. Revenus totaux.xlsx", sheet = 1)
fct = read.xlsx("Input_files\\8.1. Force de travail.xlsx", sheet = 1)
dyn = read.xlsx("Input_files\\8.2. Dynamiques de l'exploitation.xlsx", sheet = 1)
eqt = read.xlsx("Input_files\\8.3 Equipement.xlsx", sheet = 1)
acc = read.xlsx("Input_files\\9.1. Accompagnement.xlsx", sheet = 1)
ctr = read.xlsx("Input_files\\9.2. Contrats.xlsx", sheet = 1)
mch = read.xlsx("Input_files\\9.3. Distance au marché.xlsx", sheet = 1)
psp = read.xlsx("Input_files\\10. Perspectives.xlsx", sheet = 1)


# names(enq)
enq = enq[, c(1, 4, 23)]
# names(chf)
chf = chf[, c(1, 3:4)]
# names(hst)
hst = hst[, c(1:2)]
# names(sec)
sec = sec[, c(1, 3)]
# names(agr)
agr = agr[, c(1:2, 4, 6, 9:10)]
# names(div)
div = div[, c(1:5, 20:22, 24:25, 34:37)]
# names(man)
man = man[, c(1, 66:69)]
# names(mai)
mai = mai[, c(1, 46:49)]
# names(soj)
soj = soj[, c(1, 41:44)]
# names(ara)
ara = ara[, c(1, 42:45)]
# names(saf)
saf = saf[, c(1, 21:22)]
# names(cac)
cac = cac[, c(1, 12, 23)]
# names(caf)
caf = caf[, c(1, 11, 22)]
# names(pla)
pla = pla[, c(1, 12:15)]
# names(pal)
pal = pal[, c(1, 34:35)]
# names(ori)
ori = ori[, c(1, 15)]
# names(pre)
pre = pre[, c(1:2, 4:5)]
# names(bet)
bet = bet[, c(1:11, 23, 27:30)]
# names(psn)
psn = psn[, c(1:2)]
# names(res)
res = res[, c(1:2, 4, 6, 18:28, 31)]
# names(rev)
rev = rev[, c(1:2)]
# names(rvt)
rvt$revenu_agricole = rvt$revenu_agricole + rvt$revenu_elevage + rvt$revenu_pisciculture
rvt$revenu_res_nat = rvt$revenu_peche + rvt$revenu_chasse + rvt$revenu_cueillette + rvt$revenu_orpaillage + rvt$revenu_exploitation_forestiere
rvt$autre = rvt$revenu_boutique + rvt$revenu_ouvrier + rvt$revenu_employe + rvt$revenu_cadre + rvt$revenu_autre
rvt = rvt[, c(1:2, 17, 15)]
# names(fct)
fct = fct[, c(1:3)]
# names(dyn)
dyn = dyn[, c(1:2, 11)]
# names(eqt)
eqt$voit_kav_mot_usage = eqt$voiture_usage + eqt$kavaki_usage + eqt$moto_usage
eqt$voit_kav_mot_usage = ifelse(eqt$voit_kav_mot_usage > 0, 1, 0)
eqt = eqt[, c(1:2, 31, 30, 19, 27:28)]
# names(acc)
acc = acc[, c(1:2)]
# names(ctr)
ctr = ctr[, c(1:2)]
# names(mch)
mch = mch[, c(1:5)]
# names(psp)

typo = merge(loc, enq, by = "id", all.x = TRUE)
typo = merge(typo, chf, by = "id", all.x = TRUE)
typo = merge(typo, hst, by = "id", all.x = TRUE)
typo = merge(typo, sec, by = "id", all.x = TRUE)
typo = merge(typo, agr, by = "id", all.x = TRUE)
typo = merge(typo, div, by = "id", all.x = TRUE)
typo = merge(typo, man, by = "id", all.x = TRUE)
typo = merge(typo, mai, by = "id", all.x = TRUE)
typo = merge(typo, soj, by = "id", all.x = TRUE)
typo = merge(typo, ara, by = "id", all.x = TRUE)
typo = merge(typo, saf, by = "id", all.x = TRUE)
typo = merge(typo, cac, by = "id", all.x = TRUE)
typo = merge(typo, caf, by = "id", all.x = TRUE)
typo = merge(typo, pla, by = "id", all.x = TRUE)
typo = merge(typo, pal, by = "id", all.x = TRUE)
typo = merge(typo, ori, by = "id", all.x = TRUE)
typo = merge(typo, pre, by = "id", all.x = TRUE)
typo = merge(typo, bet, by = "id", all.x = TRUE)
typo = merge(typo, psn, by = "id", all.x = TRUE)
typo = merge(typo, res, by = "id", all.x = TRUE)
typo = merge(typo, rev, by = "id", all.x = TRUE)
typo = merge(typo, rvt, by = "id", all.x = TRUE)
typo = merge(typo, fct, by = "id", all.x = TRUE)
typo = merge(typo, dyn, by = "id", all.x = TRUE)
typo = merge(typo, eqt, by = "id", all.x = TRUE)
typo = merge(typo, acc, by = "id", all.x = TRUE)
typo = merge(typo, ctr, by = "id", all.x = TRUE)
typo = merge(typo, mch, by = "id", all.x = TRUE)
typo = merge(typo, psp, by = "id", all.x = TRUE)


typo$education_chef_fam = ifelse(typo$education_chef_fam == "Aucun", 0,
                                 ifelse(typo$education_chef_fam == "Education primaire", 0, 1))

typo$jachere = ifelse(typo$jachere > 0, 1, 0)

typo$surface_louee = ifelse(typo$surface_louee > 0, 1, 0)

typo$manioc_production = ifelse(typo$manioc_production > 0, 1, 0)

typo$bovins = ifelse(typo$bovins > 0, 1, 0)
typo$porcs = ifelse(typo$porcs > 0, 1, 0)
typo$petits_ruminants = ifelse(typo$petits_ruminants > 0, 1, 0)
typo$volailles = ifelse(typo$volailles > 0, 1, 0)
typo$ubt = ifelse(typo$ubt > 0, 1, 0)

typo$oeuf_productivite[is.na(typo$oeuf_productivite)] = 0
typo$oeuf_productivite = ifelse(typo$oeuf_productivite > 0, 1, 0)

typo$alim_appoint_bovins[is.na(typo$alim_appoint_bovins)] = 0
typo$alim_appoint_petits_ruminants[is.na(typo$alim_appoint_petits_ruminants)] = 0
typo$alim_appoint_porcs[is.na(typo$alim_appoint_porcs)] = 0
typo$alim_appoint_volailles[is.na(typo$alim_appoint_volailles)] = 0

typo$alim = typo$alim_appoint_bovins + typo$alim_appoint_petits_ruminants +
  typo$alim_appoint_porcs + typo$alim_appoint_volailles

typo$alim = ifelse(typo$alim > 0, 1, 0)

typo$nb_etangs = ifelse(typo$nb_etangs > 0, 1, 0)

typo$nb_pfnl = typo$chasse + typo$peche + typo$charbon + typo$miel + typo$fruits +
  typo$feuilles + typo$asperges + typo$rotins + typo$ecorces + typo$poivre + typo$seve +
  typo$seve + typo$noix + typo$chenilles + typo$champignons

typo$source_rev_1 = as.numeric(typo$source_rev_1 == "Agriculture")

typo$evolution_surf_cult_passe = as.numeric(typo$evolution_surf_cult_passe == "Augmenté")

typo$eqp_value = ifelse(typo$eqp_value > 0, 1, 0)

typo$ou_vendez_vous_vos_produits_village[is.na(typo$ou_vendez_vous_vos_produits_village)] = 0
typo$ou_vendez_vous_vos_produits_goudron[is.na(typo$ou_vendez_vous_vos_produits_goudron)] = 0
typo$ou_vendez_vous_vos_produits_chef_lieu_district_ou_departement[is.na(typo$ou_vendez_vous_vos_produits_chef_lieu_district_ou_departement)] = 0
typo$ou_vendez_vous_vos_produits_brazzaville_pointe_noire[is.na(typo$ou_vendez_vous_vos_produits_brazzaville_pointe_noire)] = 0

typo$reprise = as.numeric(typo$reprise == "Oui")

typo$statut_champ = ifelse(typo$statut_champ == "Propriété", 1, 0)

route = terra::rast('D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\road\\Distance_route_OSM.tif')

typo_spatial = typo %>%
  sf::st_as_sf(coords = c("longitude", "latitude")) %>%
  sf::st_set_crs(4326)

typo = cbind(typo, terra::extract(route, terra::vect(typo_spatial)))

names(typo)[122] = "distance_route"

typo = typo[, -c(121)]


typo$previous_vegetation = ifelse(typo$previous_vegetation == "Savane arbustive" | typo$previous_vegetation == "Savane herbacée", "Savane", typo$previous_vegetation)
typo$previous_vegetation = ifelse(typo$previous_vegetation == "1", "Forêt dégradée", typo$previous_vegetation)
typo$previous_vegetation = ifelse(typo$previous_vegetation == "2", "Forêt dense", typo$previous_vegetation)

typo$fallow_duration_simplifie = ifelse(typo$fallow_duration_simplifie == "6-11 ans" | typo$fallow_duration_simplifie == "12 ans et +",
                                        "6 ans et +", typo$fallow_duration_simplifie)
typo$fallow_duration_simplifie = ifelse(typo$fallow_duration_simplifie == "1", "1-5 ans", typo$fallow_duration_simplifie)
typo$fallow_duration_simplifie = ifelse(typo$fallow_duration_simplifie == "4", "Pas de jachère", typo$fallow_duration_simplifie)


# Normalization of continuous variables

data_typo = typo

data_typo_foret =  data_typo[which(data_typo$type3 == "Forêt"), ]
data_typo_mosaique =  data_typo[which(data_typo$type3 == "Mosaïques"), ]
data_typo_savane =  data_typo[which(data_typo$type3 == "Savanes"), ]


# write.xlsx(typo, file = "Data_typo.xlsx")

# hist(typo$taille_famille)
# hist(typo$age)
# hist(typo$cultivated_area)
typo$cultivated_area = log10(typo$cultivated_area + (0.5 * min(typo$cultivated_area[typo$cultivated_area > 0])))
# hist(typo$cultivated_area)
# hist(typo$diversite_annual)
typo$diversite_annual = log10(typo$diversite_annual + (0.5 * min(typo$diversite_annual[typo$diversite_annual > 0])))
# hist(typo$diversite_annual)
# hist(typo$diversite_perenial)
typo$diversite_perenial = log10(typo$diversite_perenial + (0.5 * min(typo$diversite_perenial[typo$diversite_perenial > 0])))
# hist(typo$diversite_perenial)
# hist(typo$diversite_total)
# hist(typo$revenu_agricole)
typo$revenu_agricole = log10(typo$revenu_agricole + (0.5 * min(na.omit(typo$revenu_agricole)[na.omit(typo$revenu_agricole) > 0])))
# hist(typo$revenu_agricole)
# hist(typo$revenu_res_nat)
typo$revenu_res_nat = log10(typo$revenu_res_nat + (0.5 * min(na.omit(typo$revenu_res_nat)[na.omit(typo$revenu_res_nat) > 0])))
# hist(typo$revenu_res_nat)
# hist(typo$revenu_autre)
typo$revenu_autre = log10(typo$revenu_autre + (0.5 * min(na.omit(typo$revenu_autre)[na.omit(typo$revenu_autre) > 0])))
# hist(typo$revenu_autre)
# hist(typo$distance_route)
typo$distance_route = log10(typo$distance_route + (0.5 * min(na.omit(typo$distance_route)[na.omit(typo$distance_route) > 0])))
# hist(typo$distance_route)



typo = typo[, c("id", "taille_famille", "age_chef_fam", "cultivated_area", "diversite_total", "diversite_annual",
                 "diversite_perenial", "revenu_agricole", "revenu_res_nat", "revenu_autre",
                 "foyer_femme", "education_chef_fam", "indigene", "jardin", "verger", 
                 "jachere", "surface_louee", "bovins", "porcs", "petits_ruminants", "volailles",
                 "securite_alim", "alim", "entraide", "main_doeuvre_ext", "groupement",
                 "contrat", "reprise", "manioc", "mais", "arachide", "safoutier", "cacao","cafe", "plantain",
                 "palmier", "evolution_surf_cult_passe", "evolution_surf_cult_future",
                 "charbon", "peche", "chasse", "orientation", "previous_vegetation",
                 "fallow_duration_simplifie", "statut_champ", "type3", "distance_route", "tracteur_usage", "voit_kav_mot_usage")]


typo_foret =  typo[which(typo$type3 == "Forêt"), ]
typo_mosaique =  typo[which(typo$type3 == "Mosaïques"), ]
typo_savane =  typo[which(typo$type3 == "Savanes"), ]

typo = na.omit(typo)

#####################################################################################################################################
# TYPOLOGIE ECHANTILLON TOTAL #######################################################################################################
#####################################################################################################################################

# PRINCIPAL COORDINATE ANALYSIS & HIERARCHICHAL CLUSTER ANALYSIS----------------

# the scaled Euclidean dissimilarity between continuous variables
dEucs = vegdist(typo[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                         "revenu_agricole", "revenu_res_nat", "revenu_autre", "distance_route"
                         )], method = "gower") 

# dissimilarity between binary variables
dBin_ppls = dist.binary(typo[, c("foyer_femme", "education_chef_fam", "indigene",
                                 "jardin", "verger", 
                                 "jachere", "surface_louee", "porcs", "petits_ruminants", 
                                 "securite_alim", "alim", "entraide", "main_doeuvre_ext", "groupement",
                                 "contrat", "reprise", "mais", "arachide", "safoutier", "cacao","cafe", "plantain",
                                 "palmier", "evolution_surf_cult_passe", "evolution_surf_cult_future", "statut_champ", "orientation",
                                 "charbon", "peche", "chasse", "tracteur_usage", "voit_kav_mot_usage")], method = 2)

typo$previous_vegetation = as.factor(typo$previous_vegetation)
typo$fallow_duration_simplifie = as.factor(typo$fallow_duration_simplifie)

table(typo$previous_vegetation)                                                  
table(typo$fallow_duration_simplifie)   


nobs <- length(typo$previous_vegetation)
d_prev_veg <- matrix(NA, nobs, nobs)
for (i in 1:nobs){
  for (j in 1:nobs){
    d_prev_veg[i,j] <- 1 - (typo$previous_vegetation[i] == typo$previous_vegetation[j])
  }
}
d_prev_veg <- as.dist(d_prev_veg)


nobs <- length(typo$fallow_duration_simplifie)
d_jach <- matrix(NA, nobs, nobs)
for (i in 1:nobs){
  for (j in 1:nobs){
    d_jach[i,j] <- 1 - (typo$fallow_duration_simplifie[i] == typo$fallow_duration_simplifie[j])
  }
}
d_jach <- as.dist(d_jach)


# Combine the 4 categories of dissimilarities, weighted by number of variables in each dissimilarity
dAll = (8 * dEucs^2 + 32 * dBin_ppls^2 + d_prev_veg^2 + d_jach^2) / 42

#Transforming the matrix of dissimilarities to a matrix of distances
distAll = sqrt(2 * dAll)
pco = cmdscale(distAll, eig = TRUE, k = 10) 
# cumsum(pco$eig) / sum(pco$eig) 
barplot(pco$eig[1:20])

# choosing 4 dimensions
pco_var = pco$points[, 1:4]

hc_pco = hclust(dist(pco_var), method = "complete")
# plot(hc_pco, hang = -1)
grpPCO = cutree(hc_pco, k = 3)


hdend = as.dendrogram(hc_pco)
hdend = color_branches(hdend, k = 3)
hdend = color_labels(hdend, k = 3)
plot(hdend)


plot(pco$points[,1], pco$points[,2], col=grpPCO)
plot(pco$points[,1], pco$points[,3], col=grpPCO)
plot(pco$points[,2], pco$points[,3], col=grpPCO)

typo$type_farm = grpPCO

data_typo = merge(data_typo, typo[, c(1, 50)], by = "id", all.x = TRUE)

data_typo$type_farm = as.factor(data_typo$type_farm)

table(data_typo$type_farm)
table(data_typo$type_farm, data_typo$departement)
table(data_typo$type_farm, data_typo$type3)

type_esq = as.data.frame(table(data_typo$type_farm, data_typo$type3))

names(type_esq) = c("Type", "Esquisse", "Freq")

ggpie(type_esq[which(type_esq$Esquisse == "Forêt"),], "Freq", label = "Type",  
      fill = "Type", color = "white", palette = "jco") +
  ggtitle("Forêt")

# ggsave("Diag circ typos exploitation - Forêt.jpeg", units = "cm", width = 10, height = 12, dpi = 320)


ggpie(type_esq[which(type_esq$Esquisse == "Mosaïques"),], "Freq", label = "Type",  
      fill = "Type", color = "white", palette = "jco") +
  ggtitle("Mosaïques")

# ggsave("Diag circ typos exploitation - Mosaïques.jpeg", units = "cm", width = 10, height = 12, dpi = 320)


ggpie(type_esq[which(type_esq$Esquisse == "Savanes"),], "Freq", label = "Type",  
      fill = "Type", color = "white", palette = "jco") +
  ggtitle("Savanes")

# ggsave("Diag circ typos exploitation - Savanes.jpeg", units = "cm", width = 10, height = 12, dpi = 320)


data_typo$type_farm = as.factor(data_typo$type_farm)

# names(data_typo)

# write.xlsx(data_typo[, c(1:2, 10, 122)], file = "Typo.xlsx")



# INTERPRETATION OF THE FARM TYPES----------------------------------------------

rf_type = randomForest(type_farm ~ ., data = na.omit(data_typo[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                                                                   "revenu_agricole", "revenu_res_nat", "revenu_autre",
                                                                   "foyer_femme", "education_chef_fam", "indigene",
                                                                   "jardin", "verger", 
                                                                   "jachere", "surface_louee", "porcs", "petits_ruminants", "volailles",
                                                                   "securite_alim", "alim", "entraide", "main_doeuvre_ext", "groupement",
                                                                   "contrat", "reprise", "mais", "arachide", "safoutier", "cacao","cafe", "plantain",
                                                                   "palmier", "evolution_surf_cult_passe", "evolution_surf_cult_future",
                                                                   "charbon", "peche", "chasse", "orientation", "previous_vegetation",
                                                                   "fallow_duration_simplifie", "statut_champ", "type_farm", "distance_route",
                                                                   "tracteur_usage", "voit_kav_mot_usage")]), ntree = 1500)


print(rf_type)


imp_total = importance(rf_type)

varImpPlot(rf_type)


data_typo[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
              "revenu_agricole", "revenu_res_nat", "revenu_autre",
              # "education_chef_fam", 
              "indigene","foyer_femme", 
              # "jardin", 
              "surface_louee",
              # "porcs", "petits_ruminants", "volailles",
              # "securite_alim", "alim", "entraide", 
              "main_doeuvre_ext",
              # "groupement",
              # "contrat",  "mais", "arachide", 
              "verger", "safoutier", "plantain","palmier",
              # "cacao","cafe", 
              "evolution_surf_cult_passe", "evolution_surf_cult_future", "reprise",
              # "charbon", "peche", "chasse",
              "statut_champ",
              "jachere", 
              "orientation",
              "distance_route",
              "previous_vegetation",
              "fallow_duration_simplifie",
              "type_farm", 
              "tracteur_usage",
              #"voit_kav_mot_usage",
              "type3")] %>%
  tbl_summary(
    by = type_farm,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
                     all_categorical() ~ "{p}%"),
    digits = all_continuous() ~ 1)%>%
  add_overall()



# my_comparisons <- list( c("1", "2"), c("2", "3"), c("1", "3"))
# 
# ggboxplot(subset(na.omit(data_typo[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
#                                        "revenu_agricole", "revenu_res_nat", "revenu_autre",
#                                        # "education_chef_fam", 
#                                        "indigene","foyer_femme", 
#                                        # "jardin", 
#                                        "surface_louee",
#                                        # "porcs", "petits_ruminants", "volailles",
#                                        # "securite_alim", "alim", "entraide", 
#                                        "main_doeuvre_ext",
#                                        # "groupement",
#                                        # "contrat",  "mais", "arachide", 
#                                        "verger", "safoutier", "plantain","palmier",
#                                        # "cacao","cafe", 
#                                        "evolution_surf_cult_passe", "evolution_surf_cult_future", "reprise",
#                                        # "charbon", "peche", "chasse",
#                                        "statut_champ",
#                                        "jachere", 
#                                        # "orientation",
#                                        "distance_route",
#                                        "previous_vegetation",
#                                        "fallow_duration_simplifie",
#                                        "type_farm", 
#                                        "tracteur_usage",
#                                        #"voit_kav_mot_usage",
#                                        "type3")])),
#           x = "type_farm", y = "taille_famille", color = "type_farm", palette = "jco") + 
#   stat_compare_means(comparisons = my_comparisons)
# 
# ggsave("Taille famille.jpeg", units = "cm", width = 15, height = 12, dpi = 320)
# 
# 
# 
# data_sum = aggregate(. ~ type_farm, FUN = sum, na.rm = TRUE, data = data_typo[, c("indigene","foyer_femme", "verger", "safoutier", "plantain","palmier",
#                                                                                  "evolution_surf_cult_passe", "evolution_surf_cult_future", "reprise",
#                                                                                  "statut_champ", "jachere", "orientation", "type_farm")])
# 
# data_mean = aggregate(. ~ type_farm, FUN = mean, na.rm = TRUE, data = data_typo[, c("indigene","foyer_femme", "verger", "safoutier", "plantain","palmier",
#                                                                                    "evolution_surf_cult_passe", "evolution_surf_cult_future", "reprise",
#                                                                                    "statut_champ", "jachere", "orientation", "type_farm")])
# 
# prop.test(data_sum$foyer_femme, c(466, 368, 574))
# 
# ggbarplot(data_mean,
#           x = "type_farm", y = "foyer_femme",  
#           color = "type_farm", palette = "jco",
#           position = position_dodge(0.8)) +
#   annotate("text", x = 2, y = 0.6, label = "p-value < 2.2e-16")
# 
# ggsave("% foyer femme.jpeg", units = "cm", width = 15, height = 12, dpi = 320)


data_sf = st_as_sf(data_typo, coords = c("longitude", "latitude"), crs ="+proj=longlat + datum = WGS84 + no_defs")
data_sf = as(data_sf, "Spatial")
data_sf = vect(data_sf)
data_sf = project(data_sf, "EPSG:4326")

cog0 = gadm(country = 'COG', level = 0, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
cog1 = gadm(country = 'COG', level = 1, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
cog2 = gadm(country = 'COG', level = 2, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')

plot(cog1)
plot(data_sf, pch = 20, cex = 2, col=c("orange","orangered", "darkred")[data_sf$type_farm],
     legend = TRUE, axes=F, add=T) 

pool = subset(cog1, subset = cog1$NAME_1 == "Pool")
boue = subset(cog1, subset = cog1$NAME_1 == "Bouenza")

plot(pool)
plot(data_sf, pch = 20, cex = 2, col=c("orange","orangered", "darkred")[data_sf$type_farm],
     legend = TRUE, axes=F, add=T) 

plot(boue)
plot(data_sf, pch = 20, cex = 2, col=c("orange","orangered", "darkred")[data_sf$type_farm],
     legend = TRUE, axes=F, add=T) 


#####################################################################################################################################
# TYPOLOGIE VILLAGES DE FORET #######################################################################################################
#####################################################################################################################################

typo_foret = na.omit(typo_foret)

# PRINCIPAL COORDINATE ANALYSIS & HIERARCHICHAL CLUSTER ANALYSIS----------------

# the scaled Euclidean dissimilarity between continuous variables
dEucs = vegdist(typo_foret[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                         "revenu_agricole", "revenu_res_nat", "revenu_autre", "distance_route"
)], method = "gower") 

# dissimilarity between binary variables
dBin_ppls = dist.binary(typo_foret[, c("foyer_femme", "education_chef_fam", "indigene",
                                 "jardin", "verger", 
                                 "jachere", "surface_louee", "porcs", "petits_ruminants", 
                                 "securite_alim", "alim", "entraide", "main_doeuvre_ext", "groupement",
                                 "contrat", "reprise", "mais", "arachide", "safoutier", "cacao","cafe", "plantain",
                                 "palmier", "evolution_surf_cult_passe", "evolution_surf_cult_future", "statut_champ", "orientation",
                                 "charbon", "peche", "chasse", "tracteur_usage", "voit_kav_mot_usage")], method = 2)

typo_foret$previous_vegetation = as.factor(typo_foret$previous_vegetation)
typo_foret$fallow_duration_simplifie = as.factor(typo_foret$fallow_duration_simplifie)

table(typo_foret$previous_vegetation)                                                  
table(typo_foret$fallow_duration_simplifie)   


nobs <- length(typo_foret$previous_vegetation)
d_prev_veg <- matrix(NA, nobs, nobs)
for (i in 1:nobs){
  for (j in 1:nobs){
    d_prev_veg[i,j] <- 1 - (typo_foret$previous_vegetation[i] == typo_foret$previous_vegetation[j])
  }
}
d_prev_veg <- as.dist(d_prev_veg)


nobs <- length(typo_foret$fallow_duration_simplifie)
d_jach <- matrix(NA, nobs, nobs)
for (i in 1:nobs){
  for (j in 1:nobs){
    d_jach[i,j] <- 1 - (typo_foret$fallow_duration_simplifie[i] == typo_foret$fallow_duration_simplifie[j])
  }
}
d_jach <- as.dist(d_jach)


# Combine the 4 categories of dissimilarities, weighted by number of variables in each dissimilarity
dAll = (8 * dEucs^2 + 32 * dBin_ppls^2 + d_prev_veg^2 + d_jach^2) / 42

#Transforming the matrix of dissimilarities to a matrix of distances
distAll = sqrt(2 * dAll)
pco = cmdscale(distAll, eig = TRUE, k = 10) 
# cumsum(pco$eig) / sum(pco$eig) 
barplot(pco$eig[1:20])

# choosing 4 dimensions
pco_var = pco$points[, 1:4]

hc_pco = hclust(dist(pco_var), method = "complete")
# plot(hc_pco, hang = -1)
grpPCO = cutree(hc_pco, k = 4)


hdend = as.dendrogram(hc_pco)
hdend = color_branches(hdend, k = 4)
hdend = color_labels(hdend, k = 4)
plot(hdend)


plot(pco$points[,1], pco$points[,2], col=grpPCO)
plot(pco$points[,1], pco$points[,3], col=grpPCO)
plot(pco$points[,2], pco$points[,3], col=grpPCO)

typo_foret$type_farm = grpPCO

data_typo_foret = merge(data_typo_foret, typo_foret[, c(1, 50)], by = "id", all.x = TRUE)

data_typo_foret$type_farm = as.factor(data_typo_foret$type_farm)

table(data_typo_foret$type_farm)
table(data_typo_foret$type_farm, data_typo_foret$departement)
table(data_typo_foret$type_farm, data_typo_foret$type3)

data_typo_foret$type_farm = as.factor(data_typo_foret$type_farm)

# write.xlsx(data_typo_foret[, c(1:2, 85)], file = "typo_foret.xlsx")



# INTERPRETATION OF THE FARM TYPES----------------------------------------------

rf_type = randomForest(type_farm ~ ., data = na.omit(data_typo_foret[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                                                                   "revenu_agricole", "revenu_res_nat", "revenu_autre",
                                                                   "foyer_femme", "education_chef_fam", "indigene",
                                                                   "jardin", "verger", 
                                                                   "jachere", "surface_louee", "porcs", "petits_ruminants", "volailles",
                                                                   "securite_alim", "alim", "entraide", "main_doeuvre_ext", "groupement",
                                                                   "contrat", "reprise", "mais", "arachide", "safoutier", "cacao","cafe", "plantain",
                                                                   "palmier", "evolution_surf_cult_passe", "evolution_surf_cult_future",
                                                                   "charbon", "peche", "chasse", "orientation", "previous_vegetation",
                                                                   "fallow_duration_simplifie", "statut_champ", "type_farm", "distance_route",
                                                                   "tracteur_usage", "voit_kav_mot_usage")]), ntree = 1500)


print(rf_type)


imp_foret =  importance(rf_type)

varImpPlot(rf_type)


data_typo_foret[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                    "revenu_agricole", "revenu_res_nat", "revenu_autre",
                    # "education_chef_fam", 
                    "indigene","foyer_femme", 
                    # "jardin", 
                    "surface_louee",
                    # "porcs", "petits_ruminants", "volailles",
                    # "securite_alim", "alim", "entraide", 
                    "main_doeuvre_ext",
                    # "groupement",
                    # "contrat",  "mais", "arachide", 
                    "verger", "safoutier", "plantain","palmier",
                    # "cacao","cafe", 
                    "evolution_surf_cult_passe", "evolution_surf_cult_future", "reprise",
                    # "charbon", "peche", "chasse",
                    "statut_champ",
                    "jachere", 
                    "orientation",
                    "distance_route",
                    "previous_vegetation",
                    "fallow_duration_simplifie",
                    "type_farm", 
                    "tracteur_usage"
                    #,
                    #"voit_kav_mot_usage",
                    )] %>%
  tbl_summary(
    by = type_farm,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
                     all_categorical() ~ "{p}%"),
    digits = all_continuous() ~ 1)%>%
  add_overall()


# data_sf = st_as_sf(data_typo_foret, coords = c("longitude", "latitude"), crs ="+proj=longlat + datum = WGS84 + no_defs")
# data_sf = as(data_sf, "Spatial")
# data_sf = vect(data_sf)
# data_sf = project(data_sf, "EPSG:4326")
# 
# cog0 = gadm(country = 'COG', level = 0, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
# cog1 = gadm(country = 'COG', level = 1, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
# cog2 = gadm(country = 'COG', level = 2, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
# 
# plot(cog1)
# plot(data_sf, pch = 20, cex = 2, col=c("orange","orangered", "darkred")[data_sf$type_farm],
#      legend = TRUE, axes=F, add=T) 



#####################################################################################################################################
# TYPOLOGIE VILLAGES DE MOSAIQUE ####################################################################################################
#####################################################################################################################################

typo_mosaique = na.omit(typo_mosaique)

# PRINCIPAL COORDINATE ANALYSIS & HIERARCHICHAL CLUSTER ANALYSIS----------------

# the scaled Euclidean dissimilarity between continuous variables
dEucs = vegdist(typo_mosaique[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                               "revenu_agricole", "revenu_res_nat", "revenu_autre", "distance_route"
)], method = "gower") 

# dissimilarity between binary variables
dBin_ppls = dist.binary(typo_mosaique[, c("foyer_femme", "education_chef_fam", "indigene",
                                       "jardin", "verger", 
                                       "jachere", "surface_louee", "porcs", "petits_ruminants", 
                                       "securite_alim", "alim", "entraide", "main_doeuvre_ext", "groupement",
                                       "contrat", "reprise", "mais", "arachide", "safoutier", "cacao","cafe", "plantain",
                                       "palmier", "evolution_surf_cult_passe", "evolution_surf_cult_future", "statut_champ", "orientation",
                                       "charbon", "peche", "chasse", "tracteur_usage", "voit_kav_mot_usage")], method = 2)

typo_mosaique$previous_vegetation = as.factor(typo_mosaique$previous_vegetation)
typo_mosaique$fallow_duration_simplifie = as.factor(typo_mosaique$fallow_duration_simplifie)

table(typo_mosaique$previous_vegetation)                                                  
table(typo_mosaique$fallow_duration_simplifie)   


nobs <- length(typo_mosaique$previous_vegetation)
d_prev_veg <- matrix(NA, nobs, nobs)
for (i in 1:nobs){
  for (j in 1:nobs){
    d_prev_veg[i,j] <- 1 - (typo_mosaique$previous_vegetation[i] == typo_mosaique$previous_vegetation[j])
  }
}
d_prev_veg <- as.dist(d_prev_veg)


nobs <- length(typo_mosaique$fallow_duration_simplifie)
d_jach <- matrix(NA, nobs, nobs)
for (i in 1:nobs){
  for (j in 1:nobs){
    d_jach[i,j] <- 1 - (typo_mosaique$fallow_duration_simplifie[i] == typo_mosaique$fallow_duration_simplifie[j])
  }
}
d_jach <- as.dist(d_jach)


# Combine the 4 categories of dissimilarities, weighted by number of variables in each dissimilarity
dAll = (8 * dEucs^2 + 32 * dBin_ppls^2 + d_prev_veg^2 + d_jach^2) / 42

#Transforming the matrix of dissimilarities to a matrix of distances
distAll = sqrt(2 * dAll)
pco = cmdscale(distAll, eig = TRUE, k = 10) 
# cumsum(pco$eig) / sum(pco$eig) 
barplot(pco$eig[1:20])

# choosing 4 dimensions
pco_var = pco$points[, 1:3]

hc_pco = hclust(dist(pco_var), method = "complete")
plot(hc_pco, hang = -1)
grpPCO = cutree(hc_pco, k = 3)


hdend = as.dendrogram(hc_pco)
hdend = color_branches(hdend, k = 3)
hdend = color_labels(hdend, k = 3)
plot(hdend)


plot(pco$points[,1], pco$points[,2], col=grpPCO)
plot(pco$points[,1], pco$points[,3], col=grpPCO)
plot(pco$points[,2], pco$points[,3], col=grpPCO)

typo_mosaique$type_farm = grpPCO

data_typo_mosaique = merge(data_typo_mosaique, typo_mosaique[, c(1, 50)], by = "id", all.x = TRUE)

data_typo_mosaique$type_farm = as.factor(data_typo_mosaique$type_farm)

table(data_typo_mosaique$type_farm)
table(data_typo_mosaique$type_farm, data_typo_mosaique$departement)
table(data_typo_mosaique$type_farm, data_typo_mosaique$type3)

data_typo_mosaique$type_farm = as.factor(data_typo_mosaique$type_farm)

# write.xlsx(data_typo_mosaique[, c(1:2, 85)], file = "typo_mosaique.xlsx")



# INTERPRETATION OF THE FARM TYPES----------------------------------------------

rf_type = randomForest(type_farm ~ ., data = na.omit(data_typo_mosaique[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                                                                         "revenu_agricole", "revenu_res_nat", "revenu_autre",
                                                                         "foyer_femme", "education_chef_fam", "indigene",
                                                                         "jardin", "verger", 
                                                                         "jachere", "surface_louee", "porcs", "petits_ruminants", "volailles",
                                                                         "securite_alim", "alim", "entraide", "main_doeuvre_ext", "groupement",
                                                                         "contrat", "reprise", "mais", "arachide", "safoutier", "cacao","cafe", "plantain",
                                                                         "palmier", "evolution_surf_cult_passe", "evolution_surf_cult_future",
                                                                         "charbon", "peche", "chasse", "orientation", "previous_vegetation",
                                                                         "fallow_duration_simplifie", "statut_champ", "type_farm", "distance_route",
                                                                         "tracteur_usage", "voit_kav_mot_usage")]), ntree = 1500)


print(rf_type)


imp_mosaique =  importance(rf_type)

varImpPlot(rf_type)


data_typo_mosaique[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                       "revenu_agricole", "revenu_res_nat", "revenu_autre",
                       # "education_chef_fam", 
                       "indigene","foyer_femme", 
                       # "jardin", 
                       "surface_louee",
                       # "porcs", "petits_ruminants", "volailles",
                       # "securite_alim", "alim", "entraide", 
                       "main_doeuvre_ext",
                       # "groupement",
                       # "contrat",  "mais", "arachide", 
                       "verger", "safoutier", "plantain","palmier",
                       # "cacao","cafe", 
                       "evolution_surf_cult_passe", "evolution_surf_cult_future", "reprise",
                       # "charbon", "peche", "chasse",
                       "statut_champ",
                       "jachere", 
                       "orientation",
                       "distance_route",
                       "previous_vegetation",
                       "fallow_duration_simplifie",
                       "type_farm", 
                       "tracteur_usage"
                       #,
                       #"voit_kav_mot_usage",
)] %>%
  tbl_summary(
    by = type_farm,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
                     all_categorical() ~ "{p}%"),
    digits = all_continuous() ~ 1)%>%
  add_overall()


# data_sf = st_as_sf(data_typo_mosaique, coords = c("longitude", "latitude"), crs ="+proj=longlat + datum = WGS84 + no_defs")
# data_sf = as(data_sf, "Spatial")
# data_sf = vect(data_sf)
# data_sf = project(data_sf, "EPSG:4326")
# 
# cog0 = gadm(country = 'COG', level = 0, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
# cog1 = gadm(country = 'COG', level = 1, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
# cog2 = gadm(country = 'COG', level = 2, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
# 
# plot(cog1)
# plot(data_sf, pch = 20, cex = 2, col=c("orange","orangered", "darkred")[data_sf$type_farm],
#      legend = TRUE, axes=F, add=T) 




#####################################################################################################################################
# TYPOLOGIE VILLAGES DE SAVANE ######################################################################################################
#####################################################################################################################################

typo_savane = na.omit(typo_savane)

# PRINCIPAL COORDINATE ANALYSIS & HIERARCHICHAL CLUSTER ANALYSIS----------------

# the scaled Euclidean dissimilarity between continuous variables
dEucs = vegdist(typo_savane[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                                  "revenu_agricole", "revenu_res_nat", "revenu_autre", "distance_route"
)], method = "gower") 

# dissimilarity between binary variables
dBin_ppls = dist.binary(typo_savane[, c("foyer_femme", "education_chef_fam", "indigene",
                                          "jardin", "verger", 
                                          "jachere", "surface_louee", "porcs", "petits_ruminants", 
                                          "securite_alim", "alim", "entraide", "main_doeuvre_ext", "groupement",
                                          "contrat", "reprise", "mais", "arachide", "safoutier", "cacao","cafe", "plantain",
                                          "palmier", "evolution_surf_cult_passe", "evolution_surf_cult_future", "statut_champ", "orientation",
                                          "charbon", "peche", "chasse", "tracteur_usage", "voit_kav_mot_usage")], method = 2)

typo_savane$previous_vegetation = as.factor(typo_savane$previous_vegetation)
typo_savane$fallow_duration_simplifie = as.factor(typo_savane$fallow_duration_simplifie)

table(typo_savane$previous_vegetation)                                                  
table(typo_savane$fallow_duration_simplifie)   


nobs <- length(typo_savane$previous_vegetation)
d_prev_veg <- matrix(NA, nobs, nobs)
for (i in 1:nobs){
  for (j in 1:nobs){
    d_prev_veg[i,j] <- 1 - (typo_savane$previous_vegetation[i] == typo_savane$previous_vegetation[j])
  }
}
d_prev_veg <- as.dist(d_prev_veg)


nobs <- length(typo_savane$fallow_duration_simplifie)
d_jach <- matrix(NA, nobs, nobs)
for (i in 1:nobs){
  for (j in 1:nobs){
    d_jach[i,j] <- 1 - (typo_savane$fallow_duration_simplifie[i] == typo_savane$fallow_duration_simplifie[j])
  }
}
d_jach <- as.dist(d_jach)


# Combine the 4 categories of dissimilarities, weighted by number of variables in each dissimilarity
dAll = (8 * dEucs^2 + 32 * dBin_ppls^2 + d_prev_veg^2 + d_jach^2) / 42

#Transforming the matrix of dissimilarities to a matrix of distances
distAll = sqrt(2 * dAll)
pco = cmdscale(distAll, eig = TRUE, k = 10) 
# cumsum(pco$eig) / sum(pco$eig) 
barplot(pco$eig[1:20])

# choosing 4 dimensions
pco_var = pco$points[, 1:4]

hc_pco = hclust(dist(pco_var), method = "complete")
plot(hc_pco, hang = -1)
grpPCO = cutree(hc_pco, k = 3)


hdend = as.dendrogram(hc_pco)
hdend = color_branches(hdend, k = 3)
hdend = color_labels(hdend, k = 3)
plot(hdend)


plot(pco$points[,1], pco$points[,2], col=grpPCO)
plot(pco$points[,1], pco$points[,3], col=grpPCO)
plot(pco$points[,2], pco$points[,3], col=grpPCO)

typo_savane$type_farm = grpPCO

data_typo_savane = merge(data_typo_savane, typo_savane[, c(1, 50)], by = "id", all.x = TRUE)

data_typo_savane$type_farm = as.factor(data_typo_savane$type_farm)

data_typo_savane$type_farm = ifelse(data_typo_savane$type_farm == "4", "3", data_typo_savane$type_farm)

table(data_typo_savane$type_farm)
table(data_typo_savane$type_farm, data_typo_savane$departement)
table(data_typo_savane$type_farm, data_typo_savane$type3)

data_typo_savane$type_farm = as.factor(data_typo_savane$type_farm)

# write.xlsx(data_typo_savane[, c(1:2, 85)], file = "typo_savane.xlsx")



# INTERPRETATION OF THE FARM TYPES----------------------------------------------

rf_type = randomForest(type_farm ~ ., data = na.omit(data_typo_savane[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                                                                            "revenu_agricole", "revenu_res_nat", "revenu_autre",
                                                                            "foyer_femme", "education_chef_fam", "indigene",
                                                                            "jardin", "verger", 
                                                                            "jachere", "surface_louee", "porcs", "petits_ruminants", "volailles",
                                                                            "securite_alim", "alim", "entraide", "main_doeuvre_ext", "groupement",
                                                                            "contrat", "reprise", "mais", "arachide", "safoutier", "cacao","cafe", "plantain",
                                                                            "palmier", "evolution_surf_cult_passe", "evolution_surf_cult_future",
                                                                            "charbon", "peche", "chasse", "orientation", "previous_vegetation",
                                                                            "fallow_duration_simplifie", "statut_champ", "type_farm", "distance_route",
                                                                            "tracteur_usage", "voit_kav_mot_usage")]), ntree = 1500)


print(rf_type)


imp_savane = importance(rf_type)

varImpPlot(rf_type)


data_typo_savane[, c("taille_famille", "age_chef_fam", "cultivated_area", "diversite_total",
                     "revenu_agricole", "revenu_res_nat", "revenu_autre",
                     # "education_chef_fam", 
                     "indigene","foyer_femme", 
                     # "jardin", 
                     "surface_louee",
                     # "porcs", "petits_ruminants", "volailles",
                     # "securite_alim", "alim", "entraide", 
                     "main_doeuvre_ext",
                     # "groupement",
                     # "contrat",  "mais", "arachide", 
                     "verger", "safoutier", "plantain","palmier",
                     # "cacao","cafe", 
                     "evolution_surf_cult_passe", "evolution_surf_cult_future", "reprise",
                     # "charbon", "peche", "chasse",
                     "statut_champ",
                     "jachere", 
                     "orientation",
                     "distance_route",
                     "previous_vegetation",
                     "fallow_duration_simplifie",
                     "type_farm", 
                     "tracteur_usage"
                     #,
                     #"voit_kav_mot_usage",
)] %>%
  tbl_summary(
    by = type_farm,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
                     all_categorical() ~ "{p}%"),
    digits = all_continuous() ~ 1)%>%
  add_overall()


# data_sf = st_as_sf(data_typo_savane, coords = c("longitude", "latitude"), crs ="+proj=longlat + datum = WGS84 + no_defs")
# data_sf = as(data_sf, "Spatial")
# data_sf = vect(data_sf)
# data_sf = project(data_sf, "EPSG:4326")

# cog0 = gadm(country = 'COG', level = 0, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
# cog1 = gadm(country = 'COG', level = 1, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
# cog2 = gadm(country = 'COG', level = 2, path = 'D:\\Mes Donnees\\1. Cirad\\PUDT\\Geo\\input-data\\admin-regions')
# 
# plot(cog1)
# plot(data_sf, pch = 20, cex = 2, col=c("orange","orangered", "darkred")[data_sf$type_farm],
#      legend = TRUE, axes=F, add=T) 

imp = data.frame(imp_total, imp_foret, imp_mosaique, imp_savane)

imp$variable = row.names(imp)

names(imp) = c("total", "foret", "mosaique", "savane", "variable")

imp = imp[, c(5, 1:4)]

imp$rank_total = rank(-imp$total)
imp$rank_foret = rank(-imp$foret)
imp$rank_mosaique = rank(-imp$mosaique)
imp$rank_savane = rank(-imp$savane)

# write.xlsx(imp, "Importance.xlsx", rowNames = FALSE)




